# file: ~/.ssh/config

# gpg-agent as ssh agent                                                 {{{1
# when storing ssh keys with gpg, export the public keys to ~/.ssh to use agent:
#
#     cd ~/.ssh
#     ssh-add -L | gawk ' { print $0 > $3 ".pub" } '
#
# See also <lnk:file:../.gnupg/sshcontrol>
#
#StrictHostKeyChecking={ .. }                                            {{{1
#  yes:        fail unless found in known hosts
#  no|off:     auto-add host keys to known hosts
# *ask:        interactively ask to confirm unknown hosts (and add them to known hosts)
#  accept-new: accept and add new, but reject changed host keys (default)
#
#CheckHostIP                                                             {{{1
# *yes:  check each host IP against known_hosts, monitor for DNS spooding.
# no:    Disable IP check and writing the IP to known hosts file.
#
#Host|Match
#  HostName:     [ %% %h ] -- real hostname to use for login (can be IP)
#  HostKeyAlias: hostname alias to use for populating and checking known_hosts.
#
#  RemoteForward remote-listen ->  local-dest
#  LocalForward   local-listen -> remote-dest
#
# ControlPath: [remote: %r %h %p] [local: %i/%u @ %L/%l ] [orig: %n] [hash: %C]
# ControlTimeout: Max time to wait for connect
# ControlPersist: max time inactive connections stay on background without clients
#
# ServerAliveCountMax M: keepalive threshold: after M*I second no response, teardown conn.
# ServerAliveInterval I:

# CanonicalizeHostname                                                   {{{1
#
# *no:     perform no name rewriting; let sys resolver handle all name lookups.
#  yes:    connections w/o a ProxyCommand/Jump: attempt canonicalize hostname
#          using CanonicalDomains + CanonicalizePermittedCNAMEs.
#  always: apply canonicalization to proxied connections as well.
#
# CanonicalDomains
#
#  If CanonicalizeHostname, then this is the list of domains to attempt
#  canonicalization against.
#
# CanonicalizeFallbackLocal
#
# *yes:  attempt lookup unqualified host using sys resolver rules.  (default)
#  no:   fail instantly if CanHosts is enabled + target hostname not found in
#        any of CanonicalDomains.
#
# CanonicalizeMaxDots
#
# *1:    allow sub.fi -> foo.sub.fi. Don't allow: foo.sub.fi -> foo.sub.fi
#  n:    disable canonicalization if hostname has over [n] dots in it.
#
# CanonicalizePermittedCNAMEs
#
#  Declare permitted CNAMEs to follow: "*.a.x.fi:*.b.x.fi,*.ex.org,*.ex2.org",
#  or generally a list of such maps [non_canon,..:canon,...] ...
#
# NOTE about ssh config file parsing                                     {{{1
#
# * for each parameter, the first obtained value will be used
# * if hostname has been canonicalized, then `Match canonical` matches only on
#   the reparse.
# * use `ssh -G host` to only parse the config and print values
#
# [id=synergysc]                                                         {{{1
#
# synergys server sharing.
#
# - [@*]$              synergys -f -a ::1:24800
# - [@applicative]$    synergyc -f    ::1:24801
# - [@samulith-relex]$ synergyc -f    ::1:24802
#
# [id=x11vnc]                                                            {{{1
#
# VNC of remote's desktop tunneled
# 1. remote server: x11vnc -localhost
# 2.  local viewer: vncviewer -MenuKey=Pause /run/user/1000/S.x11vnc-applicative
# }}}1

# Local hosts                                                            {{{1
Host localhost 127.0.0.1 ::1
  CanonicalizeHostname      no
  HostName                  %h
  HostKeyAlias              localhost
  IdentityFile              ~/.ssh/my-ecc-20181015.pub

# Jump hosts                                                             {{{1
Host *_jump
  # Perform agent forwarding for jump hosts.
  # Set longer than usual connection persistence.
  CanonicalizeHostname      no
  CheckHostIP               yes
  ControlPersist            300
  IdentitiesOnly            yes
  ServerAliveCountMax       3
  ServerAliveInterval       30
  StrictHostKeyChecking     yes
  VerifyHostKeyDNS          yes
  ForwardAgent              yes

# All hosts                                                              {{{1
Match all
  ForwardAgent              no
  Include                   ~/.ssh/conf.d/[0-9][0-9]-*.conf
  # canonicalize by default
  CanonicalizeHostname      always
  CanonicalizeFallbackLocal no
  # yes is default
  CheckHostIP               yes
  Compression               no
  ConnectionAttempts        3
  ConnectTimeout            5
  ControlMaster             auto
  ControlPath               "/run/user/%i/ssh_%r@%h:%p.conn"
  ControlPersist            15
  ExitOnForwardFailure      yes
  # Require explicitly setting key to use for authenticating
  IdentitiesOnly            yes
  ServerAliveCountMax       5
  ServerAliveInterval       5
  #TCPKeepAlive             yes
  StrictHostKeyChecking     ask
  VerifyHostKeyDNS          ask
